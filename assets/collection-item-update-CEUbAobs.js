import{k as y,h as P,l as x,r as n,u as b,j as g,C as v,n as A,i as h}from"./index-DSiCDo4C.js";import{u as z,P as C}from"./page-collection-item-add-or-update-BUsnFTB3.js";import{u as F}from"./select-image-DKXyOdpX.js";import{a as T,s as j}from"./price-wcI7WIqs.js";import"./type-service-BbVZSRKM.js";import"./yup-VDUYsaG9.js";import"./lazy-image-C2waQ_yY.js";import"./title-CuTYzyJG.js";import"./Link-DbYwmz_B.js";import"./Button-CZ8pnNLc.js";import"./Grid-BxbrYCOG.js";class R{constructor(o,r){this.service=o,this.get=r}async getProduct(){const o=await this.get(this.service);if(!o.exists())throw new Error("Produto nÃ£o encontrado");return{id:o.id,...o.data()}}}const k=i=>new R(y(P,"products",i),x).getProduct(),B=i=>{const[o,r]=n.useState(!0),[a,e]=n.useState();return n.useEffect(()=>{r(!0),(async()=>{const c=await k(i);e(c),r(!1)})()},[i]),{product:a,loading:o}},M=()=>{const{uuidItem:i}=b(),o=z(),{reset:r,loading:a,collection:e}=o,{product:t,loading:c}=B(i),[m,l]=n.useState(!1);n.useEffect(()=>{t&&!a&&r({name:t.name,image:null,imageUrl:t.image,collection:t.collection,collectionFilter:(e==null?void 0:e.filters)??"",type:t.type??"",platform:t.platform??"",amount:T(t.amount),status:t.status??"",classification:t.classification,description:t.description})},[r,t,a,e]);const E=async s=>{var f,p,d;l(!0);try{let u=t==null?void 0:t.image;(s.imageUrl!==u||s.image)&&(u=await F({imageUrl:s.imageUrl,imageFile:s.image}));const S=((f=e==null?void 0:e.filters)==null?void 0:f.includes("platforms"))??!1,I=((p=e==null?void 0:e.filters)==null?void 0:p.includes("types"))??!1,U=((d=e==null?void 0:e.filters)==null?void 0:d.includes("statuses"))??!1,w=y(P,"products",i);await A(w,{name:s.name,image:u,amount:j(s.amount),classification:s.classification,description:s.description,...S&&{platform:s.platform}||{},...U&&{status:s.status}||{},...I&&{type:s.type}||{}}),h.success(s.name+" foi atualizado com sucesso!")}catch{h.error("Erro ao atualizar produto =(")}finally{l(!1)}};return[c,a,!m].every(s=>s)?g.jsx(v,{}):g.jsx(C,{defaultValues:o.DEFAULT_VALUES,onSubmit:E,title:`Editar o item: ${t==null?void 0:t.name}`,buttonStatus:!1,buttonText:m?"Atualizando...":"Editar",collectionItemHook:o,previewImage:t==null?void 0:t.image,uuid:i})};export{M as default};
